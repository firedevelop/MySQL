CREATE DATABASE IF NOT EXISTS BIBLIOTECA_EXCEL ;

USE BIBLIOTECA_EXCEL;

-- Tabla Biblioteca
DROP TABLE IF EXISTS ALQUILERES;
CREATE TABLE ALQUILERES (
    fec_alquiler DATE,
    cod_usuario INT,
    cod_libro INT,
    tit_libro VARCHAR(200),
    cod_editorial VARCHAR(4),
    nom_editorial VARCHAR(60),
    ciu_editorial VARCHAR(60),
    aut_libro VARCHAR(200),
    nom_usuario VARCHAR(60),
    ape_usuario VARCHAR(60),
    tel_usuario VARCHAR(60),
    PRIMARY KEY (fec_alquiler , cod_libro , cod_usuario)
);

TRUNCATE ALQUILERES;

INSERT	INTO	ALQUILERES	VALUES	(	'2022-07-24' , 	'9298009' , 	'1273' , 	'A PROGRAMAR SE APRENDE JUGANDO' , 	'11' , 	'PARANINFO' , 	'MADRID' , 	'JOSE M&ORDF; MAESTRE TORREBLANCA; JES&UACUTE;S RELINQUE P&EACUTE;REZ' , 	'LORETO' , 	'DAMM MULOZ' , 	'677730785'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-10-03' , 	'26410131' , 	'1252' , 	'WINDOWS VISTA PASO A PASO' , 	'6' , 	'MC GRAW HILL' , 	'BARCELONA' , 	'CURT SIMMONS' , 	'ANDRÉ' , 	'RABELLO MESTRE' , 	'667650292'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-07-12' , 	'46005600' , 	'1307' , 	'DESARROLLADOR WEB CLAVES Y TECNICAS PARA OPTIMIZAR SITIOS' , 	'10' , 	'MP' , 	'MADRID' , 	'USERS STAFF' , 	'TEODORO' , 	'KAUSEL KROLL' , 	'631830159'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-08-17' , 	'46827228' , 	'1295' , 	'STEP 7, UNA MANERA FACIL DE PROGRAMAR PLC DE SIEMENS' , 	'1' , 	'ALFAOMEGA' , 	'MADRID' , 	'PILAR MENGUAL' , 	'ILONA' , 	'CONCHA GRABINGER' , 	'656868924'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-05' , 	'59538411' , 	'1275' , 	'ANIMACIÓN Y EFECTOS ESPECIALES CON AFTER EFFECTS: MANUALES USERS (SPANISH EDITION)' , 	'5' , 	'ANDINA' , 	'BARCELONA' , 	'LEONARDO OLIVITO' , 	'JUANA' , 	'ROMERO ZAMBRANO' , 	'623111406'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-10-12' , 	'59538411' , 	'1235' , 	'EXCEL 2007 PARA TORPES/ EXCEL 2007 FOR DUMMIES' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'ANA MARTOS RUBIO' , 	'JUANA' , 	'ROMERO ZAMBRANO' , 	'623111406'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-10-10' , 	'60733902' , 	'1258' , 	'PHP Y MYSQL PRACTICO PARA DISENADORES' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'ELLIE QUIGLEY,MARKO GARGENTA' , 	'JULIO' , 	'SANTAMARINA VIAPIANA' , 	'674530133'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-03-21' , 	'63860093' , 	'1300' , 	'ESTRUCTURA Y TECNOLOGIA DE COMPUTADORAS: TEORIA Y PROBLEMAS RESUELTOS (LIBRO EN ESP FECHA PUBLICACIÓN: 26' , 	'6' , 	'MC GRAW HILL' , 	'BARCELONA' , 	'ROMERO TERNERO' , 	'MARIO' , 	'PINO QUIVIRA' , 	'676404021'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-04-30' , 	'63860093' , 	'1241' , 	'TECNOLOGIA DIGITAL PARA DOCENTES' , 	'5' , 	'ANDINA' , 	'BARCELONA' , 	'CACCURI VIRGINIA' , 	'MARIO' , 	'PINO QUIVIRA' , 	'676404021'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-06-17' , 	'70034166' , 	'1262' , 	'WINDOWS SERVER 2008' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'FRANCISCO CHARTE OJEDA' , 	'MONIKA' , 	'BAADER M.' , 	'660375604'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-12' , 	'75545746' , 	'1275' , 	'ANIMACIÓN Y EFECTOS ESPECIALES CON AFTER EFFECTS: MANUALES USERS (SPANISH EDITION)' , 	'5' , 	'ANDINA' , 	'BARCELONA' , 	'LEONARDO OLIVITO' , 	'ENRIQUE' , 	'PAREDES HERBACH' , 	'698380128'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-06-23' , 	'78186666' , 	'1245' , 	'ENCICLOPEDIA DE MICROSOFT VISUAL C#' , 	'1' , 	'ALFAOMEGA' , 	'MADRID' , 	'CEBALLOS' , 	'PAOLA' , 	'PODESTÁ LÓPEZ' , 	'684956254'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-03-03' , 	'80140835' , 	'1270' , 	'CABLEADO DE REDES PARA VOZ, VIDEO Y DATOS' , 	'4' , 	'CENGAGE LEARNING LATIN AMERICA' , 	'VALENCIA' , 	'JIM HAYES; PAUL ROSENBERG' , 	'CARLOS' , 	'FISCHER BECERRA' , 	'645408901'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-03-30' , 	'82076204' , 	'1296' , 	'METODOS AGILES UNA ALTERNATIVA REAL Y COMPETITIVA A LOS PROCESOS TRADICIONALES DE DESARROLLO' , 	'10' , 	'MP' , 	'MADRID' , 	'PRIOLO SEBASTIA' , 	'SERGIO' , 	'GUZMAN CARACOTCH' , 	'691680027'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-09-10' , 	'87231976' , 	'1292' , 	'OFFICE 2016 (SPANISH EDITION)' , 	'5' , 	'ANDINA' , 	'BARCELONA' , 	'PEÑA MILLAHUAL CLAUDIO ALEJANDRO' , 	'DEBBIE' , 	'GUERRA MLADONADO' , 	'614478187'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-08-06' , 	'87546357' , 	'1289' , 	'CINEMATOGRAFIA EN ALTA DEFINICION' , 	'17' , 	'USERS' , 	'BARCELONA' , 	'PAUL WHEELER' , 	'SERGIO' , 	'ROJAS HOPPE' , 	'659062461'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-06-30' , 	'91065282' , 	'1239' , 	'EL LIBRO OFICIAL DE UBUNTU. EDICIÓN 2009 (TÍTULOS ESPECIALES)' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'BENJAMIN MAKO HILL' , 	'GUSTAVO' , 	'BLANCO WELLS' , 	'680379533'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-03-01' , 	'91496313' , 	'1313' , 	'200 RESPUESTAS EXCEL' , 	'10' , 	'MP' , 	'MADRID' , 	'VIRGINIA CACCARI' , 	'ELISA' , 	'CORDERO JAHR' , 	'688219312'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-09-10' , 	'136450956' , 	'1259' , 	'REDES CISCO CCNP A FONDO GUIA DE ESTUDIO PARA PROFESION  ALES' , 	'1' , 	'ALFAOMEGA' , 	'MADRID' , 	'ERNESTO ARIGANELLO' , 	'JOSELINE' , 	'TAPIA ZAMORA' , 	'698864463'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-05' , 	'146037380' , 	'1268' , 	'WINDOWS VISTA : REGISTRO Y CONFIGURACIÓN' , 	'17' , 	'USERS' , 	'BARCELONA' , 	'JAVIER SÁNCHEZ BAÑOS' , 	'KONG' , 	'SHUN AH-HEN' , 	'652282636'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-08-14' , 	'146966926' , 	'1270' , 	'CABLEADO DE REDES PARA VOZ, VIDEO Y DATOS' , 	'4' , 	'CENGAGE LEARNING LATIN AMERICA' , 	'VALENCIA' , 	'JIM HAYES; PAUL ROSENBERG' , 	'JOSÉ' , 	'GARCÉS VARGAS' , 	'650030701'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-22' , 	'146966926' , 	'1234' , 	'OFFICE DESDE CERO CONOZCA TODOS SUS SECRETOS Y APROVECHE SUS VENTAJAS' , 	'10' , 	'MP' , 	'MADRID' , 	'ALEJANDRO DAGOSTINO' , 	'JOSÉ' , 	'GARCÉS VARGAS' , 	'650030701'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-07-10' , 	'152613768' , 	'1240' , 	'ADMINISTRACIÓN DE SISTEMAS LINUX' , 	'17' , 	'USERS' , 	'BARCELONA' , 	'BILL LUBANOVIC TOM ADELSTEIN' , 	'ANDRES' , 	'HORN MORGENSTERN' , 	'660626202'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-09-02' , 	'152613768' , 	'1312' , 	'WORD 2007 (MANUALES TECNOLÓGICOS "PASO A PASO")' , 	'2' , 	'ALMUZARA' , 	'BARCELONA' , 	'VARIOS AUTORES' , 	'ANDRES' , 	'HORN MORGENSTERN' , 	'660626202'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-05' , 	'108738979' , 	'1252' , 	'WINDOWS VISTA PASO A PASO' , 	'6' , 	'MC GRAW HILL' , 	'BARCELONA' , 	'CURT SIMMONS' , 	'MARCELO' , 	'ARANCIBIA ' , 	'632060737'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-19' , 	'109442860' , 	'1286' , 	'INNOVACIONES EN SQL SERVER 2008' , 	'6' , 	'MC GRAW HILL' , 	'BARCELONA' , 	'OTEY' , 	'XIMENA' , 	'LIZANA CAMPOS' , 	'679447536'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-09-24' , 	'122129624' , 	'1264' , 	'WORD 2007 PASO A PASO' , 	'6' , 	'MC GRAW HILL' , 	'BARCELONA' , 	'GUY HART-DAVIS' , 	'IVAN' , 	'MAUREIRA BUTLER' , 	'677490616'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-10-07' , 	'122129624' , 	'1245' , 	'ENCICLOPEDIA DE MICROSOFT VISUAL C#' , 	'1' , 	'ALFAOMEGA' , 	'MADRID' , 	'CEBALLOS' , 	'IVAN' , 	'MAUREIRA BUTLER' , 	'677490616'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-09-28' , 	'122355993' , 	'1268' , 	'WINDOWS VISTA : REGISTRO Y CONFIGURACIÓN' , 	'17' , 	'USERS' , 	'BARCELONA' , 	'JAVIER SÁNCHEZ BAÑOS' , 	'GABRIEL' , 	'VALLEJOS CONTRERAS' , 	'642069641'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-07-21' , 	'127471533' , 	'1240' , 	'ADMINISTRACIÓN DE SISTEMAS LINUX' , 	'17' , 	'USERS' , 	'BARCELONA' , 	'BILL LUBANOVIC TOM ADELSTEIN' , 	'CLAUDIA' , 	'CONTRERAS ' , 	'647688171'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-07' , 	'130104533' , 	'1247' , 	'FINANZAS BASICAS CON EXCEL' , 	'1' , 	'ALFAOMEGA' , 	'MADRID' , 	'CESAR PEREZ' , 	'KAREN' , 	'MORENO FUENTEALBA' , 	'645229647'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-10-03' , 	'130104533' , 	'1244' , 	'SISTEMAS OPERATIVOS' , 	'6' , 	'MC GRAW HILL' , 	'BARCELONA' , 	'CARRETERO' , 	'KAREN' , 	'MORENO FUENTEALBA' , 	'645229647'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-07-10' , 	'131311427' , 	'1306' , 	'TÉCNICO PROFESIONAL DE PC: MANUALES USERS' , 	'5' , 	'ANDINA' , 	'BARCELONA' , 	'USERS STAFF' , 	'ALEJANDRO' , 	'FLORES Z.' , 	'622539809'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-04-28' , 	'132407061' , 	'1263' , 	'BIG DATA PARA DIRECTIVOS' , 	'7' , 	'EMPRESA ACTIVA' , 	'BARCELONA' , 	'GENIS ROCA' , 	'OLGA' , 	'BARBOSA ' , 	'628317698'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-06-08' , 	'133255508' , 	'1235' , 	'EXCEL 2007 PARA TORPES/ EXCEL 2007 FOR DUMMIES' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'ANA MARTOS RUBIO' , 	'ALICIA' , 	'ZAMBRANO DIAZ' , 	'656882337'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-03-19' , 	'135217190' , 	'1243' , 	'CLAVES DE POWER POINT Y ACCESS AVANZA' , 	'9' , 	'FOX ANDINA' , 	'MADRID' , 	'CARBALLEIRO' , 	'FRANCISCO' , 	'IBARRA SOTO' , 	'647506483'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-04-28' , 	'135217743' , 	'1261' , 	'WORD 2007 (MANUALES IMPRESCINDIBLES)' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'FRANCISCO CHARTE' , 	'MARIANNE' , 	'WERNER BECKER' , 	'615185839'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-04-06' , 	'135235512' , 	'1242' , 	'ADMINISTRACION DE PROYECTOS DE SOFTWARE' , 	'6' , 	'MC GRAW HILL' , 	'BARCELONA' , 	'CAPERS JONES' , 	'JAVIER' , 	'PARADA SILVA' , 	'626390832'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-04-18' , 	'136450956' , 	'1254' , 	'WINDOWS SERVER 2008 MANUAL DE REFERENCIA' , 	'6' , 	'MC GRAW HILL' , 	'BARCELONA' , 	'DANIELLE RUEST' , 	'JOSELINE' , 	'TAPIA ZAMORA' , 	'698864463'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-08-26' , 	'146037380' , 	'1288' , 	'C? MO PROGRAMAR EN JAVA NOVENA EDICION (SPANISH EDITION)' , 	'12' , 	'PEARSON' , 	'MADRID' , 	'PAUL DEITEL' , 	'KONG' , 	'SHUN AH-HEN' , 	'652282636'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-30' , 	'146966926' , 	'1302' , 	'REDES 200 RESPUETAS' , 	'10' , 	'MP' , 	'MADRID' , 	'SUAREZ O.' , 	'JOSÉ' , 	'GARCÉS VARGAS' , 	'650030701'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-09-20' , 	'146966926' , 	'1303' , 	'SHAREPOINT SERVER 2007' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'TISSEGHEM PATRICK' , 	'JOSÉ' , 	'GARCÉS VARGAS' , 	'650030701'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-03-11' , 	'152613768' , 	'1299' , 	'JAVA 8' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'ROGERS CADENHEAD' , 	'ANDRES' , 	'HORN MORGENSTERN' , 	'660626202'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-04-15' , 	'152613768' , 	'1270' , 	'CABLEADO DE REDES PARA VOZ, VIDEO Y DATOS' , 	'4' , 	'CENGAGE LEARNING LATIN AMERICA' , 	'VALENCIA' , 	'JIM HAYES; PAUL ROSENBERG' , 	'ANDRES' , 	'HORN MORGENSTERN' , 	'660626202'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-12' , 	'153793654' , 	'1307' , 	'DESARROLLADOR WEB CLAVES Y TECNICAS PARA OPTIMIZAR SITIOS' , 	'10' , 	'MP' , 	'MADRID' , 	'USERS STAFF' , 	'EDUARDO' , 	'SILVA RODRIGUEZ' , 	'665045118'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-04-06' , 	'161118915' , 	'1269' , 	'ANÁLISIS Y DISEÑO DE SISTEMAS Y METODOS' , 	'6' , 	'MC GRAW HILL' , 	'BARCELONA' , 	'JEFFREY L. WHITTEN' , 	'MIGUEL' , 	'FLORES CARDENAS' , 	'620264474'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-05-05' , 	'206017899' , 	'1311' , 	'APRENDE A PROGRAMAR' , 	'13' , 	'PLANETA JUNIOR' , 	'OVIEDO' , 	'VARIOS AUTORES' , 	'VALENTINA' , 	'VERA MALDONADO' , 	'666153188'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-07-29' , 	'228211702' , 	'1239' , 	'EL LIBRO OFICIAL DE UBUNTU. EDICIÓN 2009 (TÍTULOS ESPECIALES)' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'BENJAMIN MAKO HILL' , 	'FRANK' , 	'SCHANACK ' , 	'665519201'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-04-06' , 	'244320279' , 	'1279' , 	'DISEÑAR CUADROS DE MANDO CON EXCEL UTILIZANDO LAS TABLAS DINÁMICAS' , 	'14' , 	'PROFIT' , 	'VALENCIA' , 	'LUÍS MUÑIZ' , 	'DAVID' , 	'ANDRES FERNANDEZ' , 	'623298098'); 
INSERT	INTO	ALQUILERES	VALUES	(	'2022-10-18' , 	'247562486' , 	'1267' , 	'GUIA PRACTICA REDES LOCALES' , 	'3' , 	'ANAYA' , 	'OVIEDO' , 	'J. FÉLIX RÁBAGO' , 	'GAËLLE' , 	'JULIE PLISSART' , 	'637849854'); 

-- Ver todos los registros
SELECT 
    *
FROM
    alquileres;

-- Ver de que editorial es cada libro
SELECT DISTINCT
    tit_libro, nom_editorial, ciu_editorial
FROM
    alquileres;
    
-- Numero de alquileres por usuario
SELECT 
    cod_usuario,
    CONCAT(nom_usuario, ' ', ape_usuario) AS 'Nombre Completo',
    COUNT(cod_libro) AS 'Total libros alquilados'
FROM
    alquileres
GROUP BY cod_usuario;

-- Numero de alquileres por libro
SELECT 
    cod_libro,
    tit_libro,
    COUNT(cod_usuario) AS 'Total veces alquilados'
FROM
    alquileres
GROUP BY cod_libro
ORDER BY COUNT(cod_usuario) DESC;

-- Modo seguro activo (1) Inactivo(0), permite por ejemplo realizar operaciones sin el WHERE.
SET SQL_SAFE_UPDATES=0;

-- Actualizar la ciudad de la editorial ANAYA
UPDATE alquileres 
SET 
    ciu_editorial = 'VALLADOLID'
WHERE
    nom_editorial = 'ANAYA';
    
-- Vemos ahora las sedes de la editorial
SELECT DISTINCT
    cod_Editorial, nom_editorial, ciu_editorial
FROM
    ALQUILERES;

-- Ver la editorial de un libro que no recuerdo biene el nombre    
SELECT DISTINCT
    cod_libro, tit_Libro, cod_editorial, nom_editorial
FROM
    ALQUILERES
WHERE
    tit_Libro LIKE '%PROGRAMA%';
    
-- Encontrar un usuario a partir de un apellido
SELECT DISTINCT
	cod_usuario, nom_usuario, ape_usuario, tel_usuario
FROM
    ALQUILERES
WHERE
    ape_usuario LIKE '%TAPIA%';  